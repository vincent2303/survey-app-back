{"version":3,"sources":["../../routes/user.js"],"names":["express","require","router","Router","bodyParser","use","json","urlencoded","extended","morgan","Models","userCheckToken","get","req","res","console","log","user","User","findOne","where","id","user_id","then","findSondage","serverResponse","status","post","sondage_id","remplissage_id","Remplissage","findById","remplissage","sondage","answered_questions","body","answered_commentaires","updateSondage","firstName","send","msg","answerSondage","newIntensity","update","mailIntensity","err","next","name","message","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\n\nconst router = express.Router();\n\n// Le body Parser permet d'acceder aux variable envoyÃ©s dans le body\nconst bodyParser = require('body-parser');\n\nrouter.use(bodyParser.json());\nrouter.use(express.urlencoded({ extended: false }));\n\nconst morgan = require('morgan');\n\nrouter.use(morgan('dev'));\n\nconst Models = require('../models/index');\nconst userCheckToken = require('../controllers/userCheckToken');\n\n// front send un get avec header\nrouter.get('/getSondage',\n  userCheckToken,\n  (req, res) => {\n    console.log(\"info: \", req.user);\n    Models.User.findOne({ where: { id: req.user.user_id } }).then((user) => {\n      user.findSondage(req, (serverResponse) => {\n        console.log(\"Sending current sondage to front\");\n        res.status(200).json(serverResponse);\n      });\n    });\n  });\n\n\n// front send un post avec header et dans le body un answered_questions (cf index.js)\nrouter.post('/answerSondage',\n  userCheckToken,\n  (req, res) => {\n    const { user_id, sondage_id, remplissage_id } = req.user;\n    Models.Remplissage.findById(remplissage_id).then((remplissage) => {\n      if (remplissage) {\n        Models.User.findById(user_id).then((user) => {\n          const sondage = { \n            sondage_id: sondage_id,\n            remplissage_id: remplissage_id,\n            answered_questions: req.body.answered_questions,\n            answered_commentaires: req.body.answered_commentaires,\n          };\n          user.updateSondage(sondage);\n          console.log(req.user.firstName, \" already answered and changed his answers\");\n          res.status(200).send({ msg: \"Merci d'avoir modifier votre reponse !\" });\n        });\n      } else {\n        Models.User.findById(user_id).then((user) => {\n          const sondage = { \n            sondage_id: sondage_id,\n            remplissage_id: remplissage_id,\n            answered_questions: req.body.answered_questions,\n            answered_commentaires: req.body.answered_commentaires,\n          };\n          user.answerSondage(sondage);\n          console.log(\"New remplissage submitted by: \", req.user.firstName);\n          res.status(200).send({ msg: \"Merci d'avoir repondu au sondage !\" });\n        });\n      }\n    });\n  });\n\nrouter.post('/changeFreq', userCheckToken, (req, res) => {\n  if (typeof (req.body.newIntensity) === \"number\") {\n    Models.User.update(\n      { mailIntensity: req.body.newIntensity },\n      { where: req.body.user_id },\n    ).then(res.send({ msg: \"Mail Intensity changed\" }));\n  }\n});\n\nrouter.use((err, req, res, next) => {\n  console.log(\"error: \", err.name);\n  if (err.name === 'UnauthorizedError') {\n    res.status(401).json({ message: 'Unauthorized. Invalid token!' });\n  }\n});\n\nmodule.exports = router;"],"file":"user.js"}